---
layout: post
title:  "Comanche: Maximum Overkill"
date:   2025-01-31 00:00:00 -0400
categories: [game, history]
---

![]({{site.url}}/images/comanche/title.webp)

В девяностых годах авиасимуляторы были все похожи друг на друга, и у всех была одна и та же проблема - низкая (почти никакая) детализация ландшафта. Его рендерили треугольниками со сплошной заливкой. Никаких тебе текстур и, тем более, теней:

![]({{site.url}}/images/comanche/Aces-of-the-Pacific.webp)<br>
<sup>Aces of the Pacific</sup>

![]({{site.url}}/images/comanche/B-17-Flying-Fortress.webp)<br>
<sup>B-17 Flying Fortress</sup>

Компания `Novalogic`, особо ничем до этого не примечательная, "выстрелила" в 1992 году на лондонской `European Computer Trade Show`, показав новую игру `Comanche: Maximum Overkill` со впечатляющей графикой:

![]({{site.url}}/images/comanche/gameplay.webp)

Идея выросла из демо-эффекта: Кайл Фриман, разработчик игры (единственный), взял небольшую фотографию женского лица и вывел её на экран, добавив пикселям Z-координату. Применив к пикселям в динамике функцию гармонических колебаний, картинка стала развеваться, как флаг. До того, как устроиться в `Novalogic`, Кайл работал в `Biomed Instruments` и писал графические визуализации для медицинского софта, и имел опыт работы с вокселями, поэтому он заменил Z-координаты на карту высот, и результат стал напоминать поверхность земли, причём, производительности компьютера вполне хватало для плавного рендеринга в реальном времени.

> Voxel - **Vo**lumetric pi**xel**. "Объёмный пиксель". В отличие от обычного, двумерного пикселя, у него есть третья, Z-координата. Воксели, как метод визуализации, используются в различных научных областях с конца 80-х годов: в метеорологии для реалистичного расчета облачных образований. В медицине, в компьютерной томографии, для трехмерной визуализации внутреннего строения человеческого тела.
>
> `Comanche` стал первой заметной игрой, построенной на вокселях. Самый известный на сегодня продолжатель воксельной технологии - `Minecraft`. Кубики в нём - это, натурально, тоже воксели.

Применив воксельную технологию для рендеринга ландшафта, удалось добиться намного более чёткой и детализированной картинки, чем могли выдать полигональные технологии того времени.

В то время ещё не существовало ни 32-битных операционных систем для PC, ни доступных 32-битных компиляторов, поэтому пришлось всё писать самим на 32-битном ассемблере: помимо самого движка понадобился ещё и менеджер памяти, чтобы получить доступ к 4 мегабайтам ОЗУ и разместить в нём звуки и текстуры игры.

Как следствие, `Comanche` отказывался запускаться на 286 компьютерах, выводя ошибку со странным текстом: `GRC error`. Это разработчики так шутили: `Get a Real Computer`.

Кайл написал игру в одиночку примерно за девять месяцев. Помощь ему потребовалось только единожды: для реализации заставок в загрузчике миссий.

Поначалу Кайл пытался использовать в качестве редактора уровней обычный трёхмерный редактор, но быстро обнаружил, что он крайне неудобен для работы с вокселями. Пришлось написать свой пакет утилит, чтобы создавать поверхность земли без стыков. Некоторые ландшафты в игре были полностью сгенерированы фрактальными функциями, некоторые - нарисованы вручную и затем программно раскрашены, чтобы придать земле натуральный вид.

Размеры карт пришлось делать небольшими, чтобы уместиться в лимиты тогдашних компьютеров. Оперативной памяти больше 4 мегабайт у пользователей бывало крайне редко. Поэтому карта уровня в игре представляла собой два зацикленных квадрата 1024x1024 - однобайтовые карты высоты и цвета - бо́льшие территории не получалось упихать в отведённые объёмы. Использование дополнительной карты для цвета вокселя позволило помимо правильной расцветки травы и воды корректно визуализировать тени.

После релиза игры воксельный движок, который назвали [`Voxel Space`](https://en.wikipedia.org/wiki/Voxel_Space) был [запатентован](https://patents.google.com/patent/US6020893).

Почему именно `Comanche`? Во время разработки игры научно-популярные журналы писали о новейшей разработке: ударно-разведывательном вертолёте `RAH-66 Comanche`. Основное внимание уделялось лёгкости управления и малозаметности машины. Эти его характеристики, вместе с необычным внешним видом идеально подошли для игры.

После успешного релиза компания `Boeing Sikorsky` поделилась с разработчиками свежими чертежами внешнего вида вертолёта - они были совсем не против бесплатного пиара и популяризации.

При этом игра - не хардкорный симулятор. Это аркадный шутер, в котором, к тому же, нет сюжета. "Повторяя подход популярных телепередач того времени, миссии в игре должны были быть отдельными эпизодами, чтобы можно было выбрать для игры любую, какую захочется. Да и написание истории заняло бы много времени. Думаю, что я написал большую часть брифингов за день" - рассказывал Кайл. Геймплей в игре тоже простой - все миссии построены совершенно одинаково и отличаются только ландшафтом и количеством врагов.

Самым большим отличием от реальности был сам вертолёт - на тот момент самого `Comanche` ещё не существовало, первый рабочий прототип появился только в 1996 году. Противники в игре тоже были слабым местом - их было всего три типа: пушка ПВО, танк T-80 и вертолёт KA-50, которые становились опасными только из-за своей многочисленности.

Однако, это не помешало игре продаться миллионным тиражом и вскоре обзавестись дополненением: `Global Challenge`, с улучшенным поведением врагов, новыми типами противников и 30 новыми миссиями. А ещё через полгода вышло `Over The Edge` - ещё 40 новых миссий, новые противники и новые эффекты, вроде отражения от воды.

Игра `Werewolf Vs Comanche 2.0`, которая вышла в 1995, несильно отличалась от оригинала: была немного улучшена графика, добавлен новый вертолёт (KA-50) и сетевой режим для одновременной игры восьми человек. И хотя игра не стала большим хитом, миссии в игре стали более сложными, враги более умными, была улучшена модель полёта и реализована поддержка игры по модему, что дало `Novalogic` опыт в разработке сетевых игр.

Ещё через два года, в 1997 году, вышла `Comanche 3`, с обновлённым воксельным движком. Кайл признаётся, что именно третья игра, наконец, стала похожа на то, что он изначально задумывал, когда создавал первую, но был вынужден идти на компромиссы из-за ограничений в производительности тогдашних компьютеров.

`Comanche 4` (2001) стала последней игрой серии. И хотя пятая часть уже была в разработке, она была отменена примерно в то же время, когда был снят с производства настоящий `Comanche`.

Попытки реализовать порт для `Super Nintendo` и `Sega Mega Drive` не принесли результатов, и также были отменены: консольным чипам катастрофически не хватало производительности и добиться адекватного геймплея не удалось.

Вышедшая в 2021 году игра [`Comanche`](https://store.steampowered.com/app/879000/Comanche/) от `THQ Nordic` построена уже на современной полигональной технологии, а в её разработке не принимал участия никто из команды `Novalogic`: все права у неё были выкуплены в 2016 году.
